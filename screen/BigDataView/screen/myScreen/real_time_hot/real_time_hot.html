<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="zh-CN";>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title></title>
<script src="../../lib/jquery.min.js"></script>
<script src="../../../lib/echarts/dist/echarts.js"></script>

<script src="../../js/jquery.page.js"></script>
<script type="text/javascript" src="../../js/laydate.dev.js"></script>
<link rel="stylesheet" type="text/css" href="../images/global20171207.css"/>
</head>
<body>
<div class="baoye_neiy">
    <div class="tit">全国热点追踪</div>
        <div id="map"></div>
        <div class="rdzz_rightList">
        	<h1>热点城市</h1>
            <ul>
            	<li><span></span>中国</li>
            	<li><span class="bg2"></span>中国</li>
            	<li><span class="bg3"></span>中国</li>
            	<li><span class="bg4"></span>中国</li>
            	<li><span class="bg5"></span>中国</li>
            	<li><span class="bg6"></span>中国</li>
            	<li><span class="bg7"></span>中国</li>
            	<li><span class="bg8"></span>中国</li>
            	<li><span class="bg9"></span>中国</li>
            	<li><span class="bg10"></span>中国</li>
            </ul>
        </div>
        <div class="clear"></div>
</div>
<script src="../../../server.js"></script>

<script src="../../lib/layer/layer.js"></script>
<script src="../../lib/laytpl/laytpl.js"></script>
<script src="../../lib/layui/layui.js"></script>
<script>
    var nameArr={},
        nameValArr=[],
        nameKeyArr=[];
         /*初始化默认省份*/
    var nameNum='001',
	    placeName="china";
    var jiantouA=1,
        time=laydate.now(),
        cluster_name='country_1';
    var provinces = {
        '上海':'shanghai',
        '河北':'hebei',
        '山西':'shanxi1',
        '内蒙古':'neimenggu',
        '辽宁': 'liaoning',
        '吉林': 'jilin',
        '黑龙江': 'heilongjiang',
        '江苏': 'jiangsu',
        '浙江': 'zhejiang',
        '安徽': 'anhui',
        '福建': 'fujian',
        '江西': 'jiangxi',
        '山东': 'shandong',
        '河南': 'henan',
        '湖北': 'hubei',
        '湖南': 'hunan',
        '广东': 'guangdong',
        '广西': 'guangxi',
        '海南': 'hainan',
        '四川': 'sichuan',
        '贵州': 'guizhou',
        '云南': 'yunnan',
        '西藏': 'xizang',
        '陕西': 'shanxi1',
        '甘肃': 'gansu',
        '青海': 'qinghai',
        '宁夏': 'ningxia',
        '新疆': 'xinjiang',
        '北京': 'beijing',
        '天津': 'tianjin',
        '重庆': 'chongqing',
        '香港': 'xianggang',
        '澳门': 'aomen',
            "台湾":"taiwan",
            "全国":"china"
    }  
    var provincesCode = {
        "全国":"001",
        '上海':'001001',
        '河北':'001018',
        '山西':'001012',
        '内蒙古':'001003',
        '辽宁': '001029',
        '吉林': '001006',
        '黑龙江':'001034',
        '江苏': '001016',
        '浙江': '001020',
        '安徽': '001010',
        '福建': '001026',
        '江西': '001017',
        '山东': '001011',
        '河南': '001019',
        '湖北': '001022',
        '湖南': '001023',
        '广东': '001013',
        '广西': '001014',
        '海南': '001021',
        '四川': '001007',
        '贵州': '001028',
        '云南': '001002',
        '西藏': '001027',
        '陕西': '001031',
        '甘肃': '001025',
        '青海': '001032',
        '宁夏': '001009',
        '新疆': '001015',
        '北京': '001004',
        '天津': '001008',
        '重庆': '001030',
        '香港': '001033',
        '澳门': '001024',
        "台湾":"001005"
        
    }  
    var hubeicitycoDe={
        "仙桃市":"001022001",
        "十堰市":"001022002",
        "咸宁市":"001022003",
        "天门市":"001022004",
        "孝感市":"001022005",
        "宜昌市":"001022006",
        "恩施土家族苗族自治州":"001022007",
        "恩施州":"001022008",
        "武汉市":"001022009",
        "潜江市":"001022010",
        "神农架林区":"001022011",
        "荆州市":"001022012",
        "荆门市":"001022013",
        "襄樊市":"001022014",
        "襄阳市":"001022015",
        "鄂州市":"001022016",
        "随州市":"001022017",
        "黄冈市":"001022018",
        "黄石市":"001022019"
    }
    chinaData(nameNum);
    function chinaData(){
        for(item in provincesCode){
            var li=$("<li name="+provincesCode[item]+">"+item+"</li>");
            $(".Allarea").append(li);
        }
    }
    function Map(placeName,times,nameNums){
        $.ajax({
            type:"get",
            url:'../../../lib/echarts/src/util/mapData/geoJson/'+placeName+'.json',
            beforeSend:function(){
                indexA =layer.load(1, {
                        shade: [0.4,'#fff'] //0.1透明度的白色背景
                        });
                     },
            success:function(placeJson){
                 layer.close(indexA);
                  echarts.registerMap(placeName,placeJson); // 注册地图
                  var mapChart = echarts.init(document.getElementById('map'));
                  mapChart.on("click", function (param){
                         if(typeof(param.data)=="undefined"){
                            return false;
                         }
                         $(".listUlNone").show();
                         $(".listUl").empty();
                        if(typeof(param.data.area)=="undefined"){
                            placeName="china";
                            nameNum="001";
                            $(".rightTopTerritory span").html("全国");
                            $(".listTitleL span").html("全国热点");
                            listData1(0,nameNum,time,cluster_name);
                            Map(placeName,time,nameNum);
                            return false;
                            }
                        if(param.data.area.indexOf("001022")!='-1'&&param.data.area!=='001022'){
                            nameNum=param.data.area;
                            $(".listTitleL span").html(param.data.name+"热点");
                        }else{
                            if (!provinces[param.name]) {
                            placeName="china";
                            nameNum="001";
                            $(".rightTopTerritory span").html("全国");
                            $(".listTitleL span").html("全国热点");
                                }else{
                                    placeName=provinces[param.name];
                                    nameNum=provincesCode[param.name];
                                    $(".rightTopTerritory span").html(param.name);
                                    $(".listTitleL span").html(param.name+"热点");
                                    }

                            Map(placeName,time,nameNum);
                        }
                
                listData1(0,nameNum,time,cluster_name);   
            });
            option = {
                title: {
                    left: 'center',
                    textStyle: {
                        color: '#fff',
                    }
                },
                tooltip: {
                    trigger: 'item',
                },
                visualMap: {
                    min: 10,
                    max: 400,
                    text:['热度高','热度低'],
                    textStyle: {
                        color: '#fff',
                    },
                    realtime: false,
                    calculable: true,
                    inRange: {
                        color: ['#0ed7e0','#5ee496','#78e87d','#c9f632', '#ffff00']
                    }
                },
                 
                
                series: [ 
                    {
                        name: ' ',
                        type: 'map',
                        mapType: placeName,
                        label: {
                            normal: {
                                show: true
                            },
                            emphasis: {
                                show: true
                            }
                        }, 
                        itemStyle: {
                            normal: {
                                borderColor: '#389BB7',
                                areaColor: '#86dde0',
                                label:{
                                    textStyle: {
                                        fontSize:'16',
                                        color:'#F6754D'
                                    }
                                },
                            },
                            emphasis: {
                                areaColor: '#fac027',
                                borderWidth: 0
                            }
                        },
                        animation: false,
                         data:[],
                          
                    }
                ]
            };
            var tempData=[];
            //获取热度值
            if(nameNum=='001'){
             
            var dataa=bigDataUrl+XNbigUrl+"?modelid=hotpoint&serviceid=areahotpoint"+'&loaddate='+time;
            var html= $.ajax({
                type:"get",
                url:wcmUrl,
                async: false,
                data:{
                 url:dataa
                },
            }).responseText;
            html=eval("("+html+")");
            var data=html.DATA;
            if(data.length>0){
                 tempData=[];
            for(var i=0;i<data.length;i++){
            	var AREANAME=data[i].AREANAME;
                for(var i=0;i<data.length;i++){
            	var AREANAME=data[i].AREANAME;
                if(nameNum=='001'){
                    if(nameNum=='001004'){
            		AREANAME=AREANAME.replace(/密云县/, "密云区");
            	    AREANAME=AREANAME.replace(/延庆县/, "延庆区");
            	}else {
                    AREANAME=AREANAME.replace(/省/, "");
            	    AREANAME=AREANAME.replace(/市/, "");
            	    AREANAME=AREANAME.replace(/自治区/, "");
            	    AREANAME=AREANAME.replace(/回族/, "");
            	    AREANAME=AREANAME.replace(/壮族/, "");
            	    AREANAME=AREANAME.replace(/维吾尔/, "");
            	    AREANAME=AREANAME.replace(/特别行政区/, "");
                } 
                tempData.push({'name':AREANAME,'value':data[i].HOTPOINTNUM,'area':data[i].AREA})

                }else{
                tempData.push({'name':AREANAME,'value':data[i].HOTNUM,'area':data[i].AREA})
                }


               }
              }
              tempData.sort(function(a,b){
                    var tag=sortDate(a.value,b.value);
                    return tag;
                });
                
                 option.series[0].data=tempData; 
                 option.visualMap.max=tempData[0].value;   
            
            }
            }else if(nameNum=='001022'){
                tempData=[];
                for(item in hubeicitycoDe){
                    tempData.push({'name':item,'value':"",'area':hubeicitycoDe[item]})
                }
                option.series[0].data=tempData; 
                //var data=bigDataUrl+XNbigUrl+"?serviceid=areahotpoint&modelid=countryhotpoint"+'&loaddate='+time+"&area="+nameNum; 
            } 
            mapChart.setOption(option);
            }
          })


    }
    Map(placeName,time,nameNum);

    function sortDate(a,b){
        return b-a
    }
    
    laydate({
        elem: '#J-xl',max:laydate.now()
    });
    //设置input 默 认时间
    $('#J-xl').attr('value',laydate.now());
    function getData(time,cluster_name){
        //Map(placeName,time,nameNum)
        listData1(startpage,nameNum,time,cluster_name)
    }
</script>
</body>
</html>